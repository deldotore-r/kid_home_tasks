<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>Sistema de Pontos Semanal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 16px;
            background: #fafafa;
        }

        h1,
        h2 {
            color: #3a6a34;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        th,
        td {
            border: 1px solid #d1d1d1;
            padding: 8px;
            text-align: left;
            vertical-align: middle;
        }

        th {
            background: #e4f9e6;
        }

        tr:nth-child(even) {
            background: #f0f0f0;
        }

        table tr>th:nth-child(1),
        table tr>td:nth-child(1) {
            text-align: left;
        }

        table tr>th:nth-child(2),
        table tr>td:nth-child(2) {
            text-align: center;
        }

        table tr>th:nth-child(n+3),
        table tr>td:nth-child(n+3) {
            text-align: center;
        }

        .penalty {
            color: #c21e1e;
        }

        .reward {
            color: #15620e;
        }

        input[type="checkbox"] {
            vertical-align: middle;
            margin: 0 4px;
        }

        input[type="number"] {
            width: 40px;
            vertical-align: middle;
            box-sizing: border-box;
        }

        input[type="text2"] {
            width: 80px;
            vertical-align: middle;
            box-sizing: border-box;
        }

        input[type="text4"] {
            width: 60px;
            vertical-align: middle;
            box-sizing: border-box;
        }

        input:disabled {
            background-color: #eeeeee;
            cursor: not-allowed;
        }

        .flex {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 16px;
            box-sizing: border-box;
        }

        .contador-mesada-table {
            width: auto;
            border: none;
            margin-bottom: 20px;
        }

        .contador-mesada-table td,
        .contador-mesada-table th {
            border: none;
            padding: 4px 8px;
            vertical-align: middle;
            text-align: left;
        }

        .contador-mesada-table input {
            margin-left: 10px;
            width: 60px;
            box-sizing: border-box;
        }

        .admin-button {
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 20px;
            margin-right: 10px;
        }

        #reset-button {
            background: #c21e1e;
            color: white;
        }

        #reset-button:hover {
            background: #a01818;
        }

        #reset-financials-button {
            background: #0d6efd;
            color: white;
        }

        #reset-financials-button:hover {
            background: #0b5ed7;
        }

        .bonus-info {
            font-size: 0.9em;
            color: #15620e;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1 id="page-title">üåü Sistema de Pontos Semanal</h1>

        <div id="pontos-form">
            <p>
                <strong>Para: Gabriel</strong>

                <strong>Semana come√ßando em:</strong>
                <input type="text" name="semana" placeholder="Data inicial" />
            </p>

            <h2>üí∞ Como Funciona (Novas Regras)</h2>
            <ul>
                <li><strong>N√≠vel Bronze ü•â (50+ pontos):</strong> 8,00 ‚Ç¨ de mesada</li>
                <li><strong>N√≠vel Prata ü•à (80+ pontos):</strong> 10,00 ‚Ç¨ de mesada</li>
                <li><strong>N√≠vel Ouro ü•á (110+ pontos):</strong> 12,00 ‚Ç¨ de mesada</li>
                <li><strong>‚≠ê B√¥nus de Consist√™ncia:</strong> +3,00 ‚Ç¨ se fizer ao menos uma tarefa todos os dias!</li>
                <li><strong>Abaixo de 50 pontos:</strong> Sem mesada na semana.</li>
            </ul>

            <h2>‚≠ê Recompensas (Ganhar Pontos)</h2>
            <h3>üè† Tarefas Dom√©sticas</h3>
            <table>
                <tr>
                    <th>Tarefa</th>
                    <th>Pontos</th>
                    <th>Seg</th>
                    <th>Ter</th>
                    <th>Qua</th>
                    <th>Qui</th>
                    <th>Sex</th>
                    <th>S√°b</th>
                    <th>Dom</th>
                </tr>
                <tr>
                    <td>Arrumar a cama</td>
                    <td class="reward">+3</td>
                    <td><input type="checkbox" name="cama_seg" /></td>
                    <td><input type="checkbox" name="cama_ter" /></td>
                    <td><input type="checkbox" name="cama_qua" /></td>
                    <td><input type="checkbox" name="cama_qui" /></td>
                    <td><input type="checkbox" name="cama_sex" /></td>
                    <td><input type="checkbox" name="cama_sab" /></td>
                    <td><input type="checkbox" name="cama_dom" /></td>
                </tr>
                <tr>
                    <td>Organizar o quarto</td>
                    <td class="reward">+5</td>
                    <td><input type="checkbox" name="quart_seg" /></td>
                    <td><input type="checkbox" name="quart_ter" /></td>
                    <td><input type="checkbox" name="quart_qua" /></td>
                    <td><input type="checkbox" name="quart_qui" /></td>
                    <td><input type="checkbox" name="quart_sex" /></td>
                    <td><input type="checkbox" name="quart_sab" /></td>
                    <td><input type="checkbox" name="quart_dom" /></td>
                </tr>
                <tr>
                    <td>Guardar a lou√ßa</td>
                    <td class="reward">+5</td>
                    <td><input type="checkbox" name="louca_seg" /></td>
                    <td><input type="checkbox" name="louca_ter" /></td>
                    <td><input type="checkbox" name="louca_qua" /></td>
                    <td><input type="checkbox" name="louca_qui" /></td>
                    <td><input type="checkbox" name="louca_sex" /></td>
                    <td><input type="checkbox" name="louca_sab" /></td>
                    <td><input type="checkbox" name="louca_dom" /></td>
                </tr>
                <tr>
                    <td>Levar o lixo</td>
                    <td class="reward">+3</td>
                    <td><input type="checkbox" name="lixo_seg" /></td>
                    <td><input type="checkbox" name="lixo_ter" /></td>
                    <td><input type="checkbox" name="lixo_qua" /></td>
                    <td><input type="checkbox" name="lixo_qui" /></td>
                    <td><input type="checkbox" name="lixo_sex" /></td>
                    <td><input type="checkbox" name="lixo_sab" /></td>
                    <td><input type="checkbox" name="lixo_dom" /></td>
                </tr>
                <tr>
                    <td>Organizar sapatos</td>
                    <td class="reward">+3</td>
                    <td><input type="checkbox" name="sapatos_seg" /></td>
                    <td><input type="checkbox" name="sapatos_ter" /></td>
                    <td><input type="checkbox" name="sapatos_qua" /></td>
                    <td><input type="checkbox" name="sapatos_qui" /></td>
                    <td><input type="checkbox" name="sapatos_sex" /></td>
                    <td><input type="checkbox" name="sapatos_sab" /></td>
                    <td><input type="checkbox" name="sapatos_dom" /></td>
                </tr>
                <tr>
                    <td>Dobrar e guardar roupas</td>
                    <td class="reward">+4</td>
                    <td><input type="checkbox" name="dobrar_seg" /></td>
                    <td><input type="checkbox" name="dobrar_ter" /></td>
                    <td><input type="checkbox" name="dobrar_qua" /></td>
                    <td><input type="checkbox" name="dobrar_qui" /></td>
                    <td><input type="checkbox" name="dobrar_sex" /></td>
                    <td><input type="checkbox" name="dobrar_sab" /></td>
                    <td><input type="checkbox" name="dobrar_dom" /></td>
                </tr>
                <tr>
                    <td>Dar comida/√°gua √†s cachorras</td>
                    <td class="reward">+3</td>
                    <td><input type="checkbox" name="cachorras_seg" /></td>
                    <td><input type="checkbox" name="cachorras_ter" /></td>
                    <td><input type="checkbox" name="cachorras_qua" /></td>
                    <td><input type="checkbox" name="cachorras_qui" /></td>
                    <td><input type="checkbox" name="cachorras_sex" /></td>
                    <td><input type="checkbox" name="cachorras_sab" /></td>
                    <td><input type="checkbox" name="cachorras_dom" /></td>
                </tr>
            </table>

            <h3>üéØ Responsabilidades Pessoais</h3>
            <table>
                <tr>
                    <th>A√ß√£o</th>
                    <th>Pontos</th>
                    <th>Seg</th>
                    <th>Ter</th>
                    <th>Qua</th>
                    <th>Qui</th>
                    <th>Sex</th>
                    <th>S√°b</th>
                    <th>Dom</th>
                </tr>
                <tr>
                    <td>Tomar banho sem lembrete</td>
                    <td class="reward">+2</td>
                    <td><input type="checkbox" name="banho_seg" /></td>
                    <td><input type="checkbox" name="banho_ter" /></td>
                    <td><input type="checkbox" name="banho_qua" /></td>
                    <td><input type="checkbox" name="banho_qui" /></td>
                    <td><input type="checkbox" name="banho_sex" /></td>
                    <td><input type="checkbox" name="banho_sab" /></td>
                    <td><input type="checkbox" name="banho_dom" /></td>
                </tr>
                <tr>
                    <td>Escovar dentes 2x ao dia</td>
                    <td class="reward">+2</td>
                    <td><input type="checkbox" name="escova_seg" /></td>
                    <td><input type="checkbox" name="escova_ter" /></td>
                    <td><input type="checkbox" name="escova_qua" /></td>
                    <td><input type="checkbox" name="escova_qui" /></td>
                    <td><input type="checkbox" name="escova_sex" /></td>
                    <td><input type="checkbox" name="escova_sab" /></td>
                    <td><input type="checkbox" name="escova_dom" /></td>
                </tr>
                <tr>
                    <td>Fazer TPC (se houver)</td>
                    <td class="reward">+5</td>
                    <td><input type="checkbox" name="licao_seg" /></td>
                    <td><input type="checkbox" name="licao_ter" /></td>
                    <td><input type="checkbox" name="licao_qua" /></td>
                    <td><input type="checkbox" name="licao_qui" /></td>
                    <td><input type="checkbox" name="licao_sex" /></td>
                    <td><input type="checkbox" name="licao_sab" /></td>
                    <td><input type="checkbox" name="licao_dom" /></td>
                </tr>
                <tr>
                    <td>Preparar mochila p/ dia seguinte</td>
                    <td class="reward">+2</td>
                    <td><input type="checkbox" name="mochila_seg" /></td>
                    <td><input type="checkbox" name="mochila_ter" /></td>
                    <td><input type="checkbox" name="mochila_qua" /></td>
                    <td><input type="checkbox" name="mochila_qui" /></td>
                    <td><input type="checkbox" name="mochila_sex" /></td>
                    <td><input type="checkbox" name="mochila_sab" /></td>
                    <td><input type="checkbox" name="mochila_dom" /></td>
                </tr>
            </table>

            <h3>üåü Atitudes Positivas</h3>
            <table>
                <tr>
                    <th>Comportamento</th>
                    <th>Pontos</th>
                    <th>Quando acontecer (m√°x. 3x)</th>
                </tr>
                <tr>
                    <td>Ajudar sem ser pedido</td>
                    <td class="reward">+5</td>
                    <td><input type="checkbox" name="ajudar1" /><input type="checkbox" name="ajudar2" /><input
                            type="checkbox" name="ajudar3" /></td>
                </tr>
                <tr>
                    <td>Ser gentil com sua irm√£</td>
                    <td class="reward">+3</td>
                    <td><input type="checkbox" name="gentil1" /><input type="checkbox" name="gentil2" /><input
                            type="checkbox" name="gentil3" /></td>
                </tr>
                <tr>
                    <td>Obedecer na primeira</td>
                    <td class="reward">+3</td>
                    <td><input type="checkbox" name="obedecer1" /><input type="checkbox" name="obedecer2" /><input
                            type="checkbox" name="obedecer3" /></td>
                </tr>
                <tr>
                    <td>Falar a verdade quando errou</td>
                    <td class="reward">+5</td>
                    <td><input type="checkbox" name="verdade1" /><input type="checkbox" name="verdade2" /><input
                            type="checkbox" name="verdade3" /></td>
                </tr>
            </table>

            <h2>‚ö†Ô∏è Penalidades (Perder Pontos)</h2>
            <h3>‚ùå M√°s Atitudes</h3>
            <table>
                <tr>
                    <th>Comportamento</th>
                    <th>Pontos</th>
                    <th>Quando acontecer (m√°x. 3x)</th>
                </tr>
                <tr>
                    <td>Mentir</td>
                    <td class="penalty">-20</td>
                    <td><input type="checkbox" name="mentir1" /><input type="checkbox" name="mentir2" /><input
                            type="checkbox" name="mentir3" /></td>
                </tr>
                <tr>
                    <td>Desrespeitar pais/vizinhos/amigos</td>
                    <td class="penalty">-15</td>
                    <td><input type="checkbox" name="desrespeitar1" /><input type="checkbox"
                            name="desrespeitar2" /><input type="checkbox" name="desrespeitar3" /></td>
                </tr>
                <tr>
                    <td>Brigar com sua irm√£</td>
                    <td class="penalty">-15</td>
                    <td><input type="checkbox" name="brigar1" /><input type="checkbox" name="brigar2" /><input
                            type="checkbox" name="brigar3" /></td>
                </tr>
                <tr>
                    <td>N√£o fazer TPC</td>
                    <td class="penalty">-10</td>
                    <td><input type="checkbox" name="naolic1" /><input type="checkbox" name="naolic2" /><input
                            type="checkbox" name="naolic3" /></td>
                </tr>
                <tr>
                    <td>Deixar quarto bagun√ßado</td>
                    <td class="penalty">-7</td>
                    <td><input type="checkbox" name="baguncado1" /><input type="checkbox" name="baguncado2" /><input
                            type="checkbox" name="baguncado3" /></td>
                </tr>
                <tr>
                    <td>Gritar ou fazer birra</td>
                    <td class="penalty">-5</td>
                    <td><input type="checkbox" name="birra1" /><input type="checkbox" name="birra2" /><input
                            type="checkbox" name="birra3" /></td>
                </tr>
                <tr>
                    <td>Usar eletr√¥nicos sem permiss√£o</td>
                    <td class="penalty">-7</td>
                    <td><input type="checkbox" name="eletronicos1" /><input type="checkbox" name="eletronicos2" /><input
                            type="checkbox" name="eletronicos3" /></td>
                </tr>
                <tr>
                    <td>N√£o escovar os dentes 2x ao dia</td>
                    <td class="penalty">-3</td>
                    <td><input type="checkbox" name="no_escova1" /><input type="checkbox" name="no_escova2" /><input
                            type="checkbox" name="no_escova3" /></td>
                </tr>
            </table>

            <h2>üìä Contador Semanal</h2>
            <div class="flex">
                <div>
                    <h3>üìà Pontos Ganhos</h3>
                    <table class="contador-mesada-table">
                        <tbody>
                            <tr>
                                <td>Segunda:</td>
                                <td><input type="number" name="seg_pontos" readonly></td>
                            </tr>
                            <tr>
                                <td>Ter√ßa:</td>
                                <td><input type="number" name="ter_pontos" readonly></td>
                            </tr>
                            <tr>
                                <td>Quarta:</td>
                                <td><input type="number" name="qua_pontos" readonly></td>
                            </tr>
                            <tr>
                                <td>Quinta:</td>
                                <td><input type="number" name="qui_pontos" readonly></td>
                            </tr>
                            <tr>
                                <td>Sexta:</td>
                                <td><input type="number" name="sex_pontos" readonly></td>
                            </tr>
                            <tr>
                                <td>S√°bado:</td>
                                <td><input type="number" name="sab_pontos" readonly></td>
                            </tr>
                            <tr>
                                <td>Domingo:</td>
                                <td><input type="number" name="dom_pontos" readonly></td>
                            </tr>
                            <tr>
                                <td><strong>TOTAL DE PONTOS:</strong></td>
                                <td><input type="number" name="total_pontos" readonly></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div>
                    <h3>üíµ C√°lculo da Mesada</h3>
                    <table class="contador-mesada-table">
                        <tbody>
                            <tr>
                                <td>Pontos desta semana:</td>
                                <td><input type="number" name="pontos_semana" readonly></td>
                            </tr>
                            <tr>
                                <td>Valor conquistado:</td>
                                <td><input type="text4" name="valor_conquistado" readonly></td>
                            </tr>
                            <tr>
                                <td>Pr√™mios acumulados:</td>
                                <td><input type="text4" name="premios_acumulados" value="0.00"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <h2>üéØ Meu Objetivo de Compra</h2>
            <p>O que quero comprar: <input type="text2" name="objetivo" /></p>
            <table class="contador-mesada-table">
                <tbody>
                    <tr>
                        <td>Pre√ßo: ‚Ç¨</td>
                        <td><input type="number" name="preco" step="0.01" /></td>
                    </tr>
                    <tr>
                        <td>Dinheiro extra: ‚Ç¨</td>
                        <td><input type="number" name="dinheiro_extra" step="0.01" value="0.00" /></td>
                    </tr>
                    <tr>
                        <td>J√° tenho: ‚Ç¨</td>
                        <td><input type="number" name="ja_tenho" step="0.01" readonly /></td>
                    </tr>
                    <tr>
                        <td>Ainda preciso: ‚Ç¨</td>
                        <td><input type="number" name="ainda_preciso" readonly /></td>
                    </tr>
                </tbody>
            </table>

            <div id="admin-controls"
                style="display: none; margin-top: 30px; border-top: 2px solid #ccc; padding-top: 20px;">
                <h2>Controles Administrativos</h2>
                <button id="reset-button" class="admin-button">üßπ Limpar para Nova Semana</button>
                <button id="reset-financials-button" class="admin-button">üí∞ Zerar Contadores Financeiros</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <script>
        // --- CONFIGURA√á√ÉO E VARI√ÅVEIS GLOBAIS ---
        const firebaseConfig = {
            apiKey: "AIzaSyD0JgGuqonnNw9ng9yhbQBkMnw8gwvb-V4",
            authDomain: "sistema-de-pontos-semanal.firebaseapp.com",
            databaseURL: "https://sistema-de-pontos-semanal-default-rtdb.firebaseio.com",
            projectId: "sistema-de-pontos-semanal",
            storageBucket: "sistema-de-pontos-semanal.firebasestorage.app",
            messagingSenderId: "496275393704",
            appId: "1:496275393704:web:eadec1594b893fd15ec69d"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const dataRef = database.ref('formData');
        let isUpdatingFromFirebase = false;
        let isReadOnly = false;

        const DIAS_SEMANA = ["seg", "ter", "qua", "qui", "sex", "sab", "dom"];
        const TAREFAS_DIARIAS = [
            { name: "cama_", value: 3 }, { name: "quart_", value: 5 }, { name: "louca_", value: 5 },
            { name: "lixo_", value: 3 }, { name: "sapatos_", value: 3 }, { name: "dobrar_", value: 4 },
            { name: "cachorras_", value: 3 }, { name: "banho_", value: 2 }, { name: "escova_", value: 2 },
            { name: "licao_", value: 5 }, { name: "mochila_", value: 2 }
        ];
        const ATITUDES_POSITIVAS = [
            { name: "ajudar", value: 5 }, { name: "gentil", value: 3 },
            { name: "obedecer", value: 3 }, { name: "verdade", value: 5 }
        ];
        const PENALIDADES = [
            { name: "mentir", value: -20 }, { name: "desrespeitar", value: -15 }, { name: "brigar", value: -15 },
            { name: "naolic", value: -10 }, { name: "baguncado", value: -7 }, { name: "birra", value: -5 },
            { name: "eletronicos", value: -7 }, { name: "no_escova", value: -3 }
        ];

        // --- L√ìGICA DE PERMISS√ÉO E CONTROLES ---
        function applyPermissions() {
            const urlParams = new URLSearchParams(window.location.search);
            const user = urlParams.get('user');
            if (user && user.toLowerCase() === 'gabriel') {
                isReadOnly = true;
                document.getElementById('page-title').textContent = 'üåü Sistema de Pontos (Modo Leitura)';
                document.querySelectorAll('#pontos-form input').forEach(input => {
                    if (!input.readOnly) input.disabled = true;
                });
            } else {
                document.getElementById('admin-controls').style.display = 'block';
            }
        }

        // --- L√ìGICA DE LIMPEZA ---
        function resetWeek() {
            if (!confirm("Tem certeza que deseja limpar os dados da semana? O valor conquistado ser√° somado aos pr√™mios acumulados.")) return;

            const valorConquistado = parseFloat(document.querySelector('input[name="valor_conquistado"]').value.replace(/‚Ç¨/g, '').replace(/\(B√¥nus! ‚≠ê\)/g, '').trim()) || 0;
            const premiosAcumuladosAtual = parseFloat(document.querySelector('input[name="premios_acumulados"]').value) || 0;

            const novosPremiosAcumulados = premiosAcumuladosAtual + valorConquistado;

            const fieldsToKeep = {
                premios_acumulados: novosPremiosAcumulados.toFixed(2),
                dinheiro_extra: document.querySelector('input[name="dinheiro_extra"]').value,
                objetivo: document.querySelector('input[name="objetivo"]').value,
                preco: document.querySelector('input[name="preco"]').value
            };

            const today = new Date();
            fieldsToKeep.semana = `${String(today.getDate()).padStart(2, '0')}/${String(today.getMonth() + 1).padStart(2, '0')}/${today.getFullYear()}`;

            dataRef.set(fieldsToKeep);
        }

        function resetFinancials() {
            if (!confirm("ATEN√á√ÉO: Tem certeza que deseja ZERAR os 'Pr√™mios acumulados' e o 'Dinheiro extra'? Esta a√ß√£o √© recomendada apenas ao comprar um objetivo.")) return;

            // Atualiza os campos no Firebase
            dataRef.update({
                premios_acumulados: "0.00",
                dinheiro_extra: "0.00"
            });
        }

        // --- L√ìGICA DE C√ÅLCULO ---
        function calcularFinancas() {
            const premiosAcumulados = parseFloat(document.querySelector('input[name="premios_acumulados"]').value) || 0;
            const dinheiroExtra = parseFloat(document.querySelector('input[name="dinheiro_extra"]').value) || 0;
            const preco = parseFloat(document.querySelector('input[name="preco"]').value) || 0;

            const jaTenho = premiosAcumulados + dinheiroExtra;
            const aindaPreciso = preco - jaTenho;

            document.querySelector('input[name="ja_tenho"]').value = jaTenho.toFixed(2);
            document.querySelector('input[name="ainda_preciso"]').value = aindaPreciso > 0 ? aindaPreciso.toFixed(2) : "0.00";
        }

        function calcularPontos() {
            let totalPontos = 0;
            const pontosDiarios = { seg: 0, ter: 0, qua: 0, qui: 0, sex: 0, sab: 0, dom: 0 };
            const diasComTarefas = new Set();

            TAREFAS_DIARIAS.forEach(item => {
                DIAS_SEMANA.forEach(dia => {
                    const el = document.querySelector(`input[name="${item.name}${dia}"]`);
                    if (el && el.checked) {
                        totalPontos += item.value;
                        pontosDiarios[dia] += item.value;
                        diasComTarefas.add(dia);
                    }
                });
            });

            ATITUDES_POSITIVAS.forEach(item => {
                for (let i = 1; i <= 3; i++) {
                    const el = document.querySelector(`input[name="${item.name}${i}"]`);
                    if (el && el.checked) totalPontos += item.value;
                }
            });

            PENALIDADES.forEach(item => {
                for (let i = 1; i <= 3; i++) {
                    const el = document.querySelector(`input[name="${item.name}${i}"]`);
                    if (el && el.checked) totalPontos += item.value;
                }
            });

            document.querySelector('input[name="total_pontos"]').value = totalPontos;
            document.querySelector('input[name="pontos_semana"]').value = totalPontos;
            DIAS_SEMANA.forEach(dia => {
                const campoDia = document.querySelector(`input[name="${dia}_pontos"]`);
                if (campoDia) campoDia.value = pontosDiarios[dia];
            });

            let valorBase = 0;
            if (totalPontos >= 110) valorBase = 12;
            else if (totalPontos >= 80) valorBase = 10;
            else if (totalPontos >= 50) valorBase = 8;

            let bonusConsistencia = 0;
            if (diasComTarefas.size === 7) {
                bonusConsistencia = 3;
            }

            const valorFinal = valorBase + bonusConsistencia;
            let textoValor = `‚Ç¨ ${valorFinal.toFixed(2)}`;
            if (bonusConsistencia > 0) {
                textoValor += ` (B√¥nus! ‚≠ê)`;
            }
            document.querySelector('input[name="valor_conquistado"]').value = textoValor;

            calcularFinancas();
        }

        // --- L√ìGICA DO FIREBASE ---
        function saveDataToFirebase() {
            if (isUpdatingFromFirebase) return;
            const formData = {};
            document.querySelectorAll('#pontos-form input').forEach(input => {
                if (input.readOnly) return;
                const name = input.name;
                if (input.type === 'checkbox') {
                    formData[name] = input.checked;
                } else {
                    formData[name] = input.value;
                }
            });
            dataRef.set(formData);
        }

        function loadDataFromFirebase(data) {
            isUpdatingFromFirebase = true;
            document.querySelectorAll('#pontos-form input').forEach(input => {
                const name = input.name;
                if (data.hasOwnProperty(name)) {
                    if (input.type === 'checkbox') {
                        input.checked = data[name];
                    } else {
                        input.value = data[name];
                    }
                } else {
                    if (input.type === 'checkbox') {
                        input.checked = false;
                    }
                }
            });
            isUpdatingFromFirebase = false;
            calcularPontos();
        }

        // --- INICIALIZA√á√ÉO ---
        applyPermissions();

        if (!isReadOnly) {
            document.getElementById('reset-button').addEventListener('click', resetWeek);
            document.getElementById('reset-financials-button').addEventListener('click', resetFinancials);
        }

        document.querySelectorAll('#pontos-form input').forEach(input => {
            if (!input.disabled && !input.readOnly) {
                const eventType = (input.type === 'checkbox' || input.type === 'number') ? 'change' : 'keyup';
                input.addEventListener(eventType, () => {
                    // N√£o salva imediatamente no keyup para evitar sobrecarga, mas calcula para feedback
                    if (eventType === 'keyup') {
                        calcularPontos();
                    } else {
                        saveDataToFirebase();
                        calcularPontos();
                    }
                });
                // Adiciona um listener 'blur' para salvar campos de texto quando o usu√°rio sai deles
                if (input.type !== 'checkbox') {
                    input.addEventListener('blur', saveDataToFirebase);
                }
            }
        });

        dataRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                loadDataFromFirebase(data);
            } else {
                calcularPontos();
            }
        });
    </script>
</body>

</html>